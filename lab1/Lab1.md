# Лабораторная работа 1.1 Установка и настройка ETL-инструмента. Создание конвейеров данных

## Цель работы

Изучение основных принципов работы с ETL-инструментами на примере Pentaho Data Integration (PDI), настройка среды, создание конвейера обработки данных (фильтрация, очистка, замена значений) и выгрузка результатов в базу данных MySQL.

## Индивидуальное задание

Вариант 12.	Недвижимость: очистка и трансформация данных.

Общая схема:

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20055707.png" />

## Шаг 1. Запуск Pentaho Spoon

Переходим в нужный каталог и запускаем исполняемый файл:

<img width="800" height="396" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-11%20225557.png" />

Видим, что у нас открылся Pentaho:

<img width="800" height="600" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-11%20225638.png" />

## Шаг 2. Импорт данных

Источник данных: [датасет]()

Описание данных:

- price - цена квартиры в рублях
- date - дата публикации объявления о продаже квартиры
- time - время публикации объявления о продаже квартиры
- geo_lat - широта (координаты квартиры)
- geo_lon - долгота  (координаты квартиры)
- region - номер региона
- building_type - тип дома (монолитный, панельный, кирпичный и т.д.)
- level - этаж, на котором находится квартира
- levels - количество этажей в доме
- rooms - количество комнат в квартире
- area - общая площадь
- kitchen_area - площадь кухни
- object_type - тип объекта (новостройка или вторчное жилье)

Для импорта данных добавляем узел "CSV file import":

<img width="300" height="300" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045025.png" />

В настройках указываем путь к файлу:

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20050455.png" />

Также можно задать типы данных:

<img width="500" height="800" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20055717.png" />

## Шаг 2. Обработка данных

2.1. В датасете есть 2 поля "building_type" и "object_type", у которых значения в виде чисел, каждое из которых соответствует определенному значению. Для удобства заменим числовые значения на соответствующие им текстовые с помощью "Value mapper":

<img width="300" height="300" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045048.png" />

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045102.png" />

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045111.png" />

2.2. Затем с помощью компонента "Select_values" заменим названия нескольких полей, зададим типы данных и форматы:

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045237.png" />

2.3. Далее выберем поля, которые нам необходимы для анализа и которые мы хотим перенести в базу данных, с помощью компонента "Memory group by":

<img width="300" height="300" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045253.png" />

<img width="600" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045301.png" />

2.4. В ходе предварительного анализа данных было выяснено, что поле rooms содержит некорректные данные. Значения данного поля - целые числа (1,2,3...), обозначают число комнат в квартире. Значение "-1" указывает на то, что квартира является студией, другие отрицательные значения недопустимы. Осуществим фильтрацию с помощью "Filter rows" на основе этого условия:

<img width="300" height="300" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045308.png" />

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045317.png" />

2.5. Также предварительный анализ показал, что данные содержат дубликаты. Для их удаления воспользуемся компонентом "Unique rows (HashSet)":

<img width="300" height="300" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045324.png" />

Оставим незаполненным поле Fieldname, чтобы учитывались только полностью дублированные строки:

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045317.png" />

2.6. Создадим новую метрику price_per_m2 (цена за квадратный метр) c помощью "Calculator":

<img width="300" height="300" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045339.png" />

В настройках зададим формулу: цена/площадь квартиры:

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045350.png" />

## Шаг 3.Загрузка обработанных данных в базу данных

Сначала создадим таблицу в базе данных:

<img width="600" height="300" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20052359.png" />

<img width="300" height="600" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20052412.png" />

Затем этого добавим компонент "Table_output":

<img width="300" height="300" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045355.png" />

Настроим подключение к базе данных:

Укажем схему и таблицу, в которую нужно загрузить данные:

<img width="700" height="900" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20045403.png" />

## Шаг 4. Запуск

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-13%20234758.png" />

## Шаг 5. SQL-запросы

5.1. Посмотрим первые 10 строк таблицы:

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20052633.png" />

5.2. Посмотрим число строк в таблице:

<img width="800" height="500" alt="image" src="/lab1/images/Снимок%20экрана%202026-02-14%20052728.png" />

5.3. Создадим рейтинг регионов по цене за квадратный метр, отсортированный по убыванию:

<img width="800" height="500" alt="image" src="" />

